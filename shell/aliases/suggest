#!/bin/bash

alias salias="suggest_alias_for_task"
alias stmux="suggest_tmux_shortcut"
alias sman="dot suggest command_usage"

function suggest_alias_for_task() {
	if [ -z "$*" ]; then
		echo "Please provide a prompt describing what you want to achieve"
		return 1
	fi

	# Collect all alias definitions and scripts
	alias_content=""
	for file in "$DOTFILES_PATH"/shell/aliases/*; do
		if [ -f "$file" ]; then
			alias_content+="# From $(basename "$file"):"$'\n'
			alias_content+="$(cat "$file")"$'\n'
		fi
	done

	local prompt=$(
		cat <<EOF
You are a shell alias expert. Given these aliases:

$alias_content
Task: $@

First, tell me if there are any EXISTING aliases that help with this task.
Then, if needed, suggest new aliases that would be helpful.

Format your response exactly like this:
EXISTING ALIASES:
1. alias_name: what it does
or 'No existing aliases found for this task'

SUGGESTED NEW ALIASES:
1. alias_name='command'
or 'No new aliases suggested'
EOF
	)

	ask_ai "$prompt"
}

function suggest_tmux_shortcut() {
	if [ -z "$*" ]; then
		echo "Please provide a prompt describing what you want to achieve"
		return 1
	fi

	local prompt=$(
		cat <<EOF
Given my notes about my configuration of tmux:

$(cat $DOTFILES_PATH/docs/shortcuts/tmux.md)

And my current tmux configuration:

$(cat $DOTFILES_PATH/tmux/.tmux.conf)

I want to: $@

First, tell me if there are any EXISTING shortcuts that help with this task.
Then, if needed, suggest new shortcuts that would be helpful.

Format your response exactly like this:
EXISTING SHORTCUTS:
1. shortcut: what it does
or 'No existing shortcuts found for this task'

SUGGESTED NEW SHORTCUTS:
1. shortcut: how can I configure it
or 'No new shortcuts suggested'
EOF
	)

	ask_ai "$prompt"
}